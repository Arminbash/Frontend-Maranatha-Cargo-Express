

@{
    ViewBag.Title = "Users";
    Layout = "~/Views/Shared/Layouts/_EmployeeMainLayout.cshtml";
}

<div class="row">
    <div class="col-xl-12">
        <div class="card card-custom">
            <div class="card-header flex-wrap border-0 pt-6 pb-0">
                <div class="card-title">
                    <h3 class="card-label">
                        Lista de clientes
                    </h3>
                </div>
                <div class="card-toolbar">
                    <a class="btn btn-primary font-weight-bolder" data-toggle="modal" data-target="#exampleModalCenter">
                        <span class="svg-icon svg-icon-md">
                            <!--begin::Svg Icon | path:assets/media/svg/icons/Design/Flatten.svg-->
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <rect x="0" y="0" width="24" height="24" />
                                    <circle fill="#000000" cx="9" cy="15" r="6" />
                                    <path d="M8.8012943,7.00241953 C9.83837775,5.20768121 11.7781543,4 14,4 C17.3137085,4 20,6.6862915 20,10 C20,12.2218457 18.7923188,14.1616223 16.9975805,15.1987057 C16.9991904,15.1326658 17,15.0664274 17,15 C17,10.581722 13.418278,7 9,7 C8.93357256,7 8.86733422,7.00080962 8.8012943,7.00241953 Z" fill="#000000" opacity="0.3" />
                                </g>
                            </svg>
                            <!--end::Svg Icon-->
                        </span>Nuevo Cliente
                    </a>
                    <div class="modal fade" id="exampleModalCenter" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel" >Nuevo Cliente</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <i aria-hidden="true" class="ki ki-close"></i>
                                    </button>
                                </div>
                                <div class="modal-body" id="KTClient">
                                    <form class="form" id="kt_Client">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <label>Full Name:</label>
                                                <input type="email" class="form-control" placeholder="Enter full name" name="IdTipoPersona" id="IdTipoPersona" />
                                            </div>
                                            <div class="form-group">
                                                <label>Email address:</label>
                                                <input type="email" class="form-control" placeholder="Enter email" name="IdTipoCliente" id="IdTipoCliente" />
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary font-weight-bold" id="kt_client_submit">Save changes</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <table class="table table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">PersonaId</th>
                        <th scope="col">TipoClienteId</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var oElemento in @ViewBag.ListaCliente)
                    {
                        <tr>
                            <td>@oElemento.Id</td>
                            <td>@oElemento.PersonaId</td>
                            <td>@oElemento.TipoClienteId</td>
                            <td>
                                @if (@oElemento.Estado == true)
                                {
                                    <span class="label label-inline label-light-primary font-weight-bold">
                                        @oElemento.Estado
                                    </span>
                                }
                                else
                                {
                                    <span class="label label-inline label-light-danger font-weight-bold">
                                        @oElemento.Estado
                                    </span>
                                }
                            </td>
                            <td>
                                <a class="fas fa-pencil-alt text-warning mr-5 icon-lg " id="kt_client_open" data-toggle="modal" data-target="#exampleModalCenter" title="Editar"></a>
                                <a class="fas fa-trash text-danger mr-5 icon-lg " title="Eliminar"></a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
@section scripts {
    <script>
        "use strict";

        // Class Definition
        var KTClient = function () {
          

            var _handleClientForm = function () {
                var validation;

                // Init form validation rules. For more info check the FormValidation plugin's official documentation:https://formvalidation.io/
                validation = FormValidation.formValidation(
                    KTUtil.getById('kt_Client'),
                    {
                        fields: {
                            IdTipoPersona: {
                                validators: {
                                    notEmpty: {
                                        message: 'IdTipoPersona es requerido'
                                    }
                                }
                            },
                            IdTipoCliente: {
                                validators: {
                                    notEmpty: {
                                        message: 'IdTipoCliente es requerida'
                                    }
                                }
                            }
                        },
                        plugins: {
                            trigger: new FormValidation.plugins.Trigger(),
                            submitButton: new FormValidation.plugins.SubmitButton(),
                            //defaultSubmit: new FormValidation.plugins.DefaultSubmit(), // Uncomment this line to enable normal button submit after form validation
                            bootstrap: new FormValidation.plugins.Bootstrap()
                        }
                    }
                );

                $('#kt_client_submit').on('click', function (e) {
                    e.preventDefault();

                    validation.validate().then(function (status) {
                        if (status == 'Valid') {
                            AddClient();
                            Limpiar();
                            CerrarModal();

                        } else {
                            swal.fire({
                                text: "Lo sentimos, parece que se han detectado algunos errores, intentalo de nuevo.",
                                icon: "error",
                                buttonsStyling: false,
                                confirmButtonText: "Entiendo!",
                                customClass: {
                                    confirmButton: "btn font-weight-bold btn-light-primary"
                                }
                            }).then(function () {
                                KTUtil.scrollTop();
                            });
                        }
                    });
                });
             
            }

            // Public Functions
            return {
                // public functions
                init: function () {


                    _handleClientForm();
                }
            };
        }();

        // Class Initialization
        jQuery(document).ready(function () {
            KTClient.init();
        });

    </script>
    <script>
        function AddClient() {
           /* var urlRedirect = $("#RedirectTo").val();*/

            var PersonaId = $("#IdTipoPersona").val();
            var TipoClienteId = $("#IdTipoCliente").val();
            var Estado = true;
            var cliente = {
                PersonaId: PersonaId,
                TipoClienteId: TipoClienteId,
                Estado: Estado
            };
            $.ajax({
                type: 'POST',
                url: '@Url.Action("AddClient", "Client")',
                dataType: 'json',
                data: cliente,
                async:false,
                success: function (data) {
                    /*location.href = urlRedirect;*/
                    swal.fire({
                        text: "se guardo correctamente",
                        icon: "success",
                        buttonsStyling: false,
                        confirmButtonText: "Entiendo!",
                        customClass: {
                            confirmButton: "btn font-weight-bold btn-light-primary"
                        }
                    }).then(function () {
                        KTUtil.scrollTop();
                    });
                },
                error: function (ex) {
                    swal.fire({
                        text: "error a guardar",
                        icon: "error",
                        buttonsStyling: false,
                        confirmButtonText: "Entiendo!",
                        customClass: {
                            confirmButton: "btn font-weight-bold btn-light-primary"
                        }
                    }).then(function () {
                        KTUtil.scrollTop();
                    });
                }
            });
        }
    </script>
    <script>
        function CerrarModal() {
            $('#exampleModalCenter').modal('toggle');
        }
    </script>
    <script>
        function Limpiar() {
            $("#kt_Client")[0].reset();
        }
    </script>
    @*<script>
            $('#kt_client_open').on('click', function (e) {
                e.preventDefault();
                $('#exampleModalCenter').modal('show');
              /*  $("#exampleModalLabel").text('Editar Cliente');*/
               
            });
    </script>*@
}